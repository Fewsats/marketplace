import { ImageResponse } from 'next/og';
import React from 'react';
import { FileObject } from '@/app/types';

// Define the size of the Open Graph image
export const alt = 'Fewsats Marketplace';
export const size = {
  width: 1200,
  height: 628,
};

// Define runtime options
export const runtime = 'edge';

async function fetchFile(id: string) {
  const res = await fetch(`${process.env.API_URL}/v0/storage/${id}`, {
    next: { tags: ['file'] },
    headers: {
      'Content-Type': 'application/json',
    },
  });
  if (!res?.ok) return undefined;
  return res.json();
}

// Function to generate the image
export default async function Image({ params }: { params: { id: string } }) {
  const data: { file: FileObject } = await fetchFile(params.id);

  return new ImageResponse(
    (
      <div
        style={{
          background: 'white',
          width: '100%',
          height: '100%',
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          position: 'relative',
        }}
      >
        <img
          src={`${data.file.cover_url}`}
          alt={alt}
          style={{
            objectFit: 'cover',
            width: '100%',
            height: '100%',
            position: 'absolute',
            filter: 'blur(4px)',
          }}
          width={size.width}
          height={size.height}
        />
        <div
          style={{
            background: 'rgba(0, 0, 0, 0.4)',
            width: '100%',
            height: '100%',
            position: 'relative',
            zIndex: 1,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <svg
            style={{ width: '800px', height: '235px' }}
            width='126'
            height='37'
            viewBox='0 0 126 37'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              d='M13.2112 2.10303L3.23164 7.87257V12.3483L13.2112 6.57835L23.1905 12.3483V7.87257L13.2112 2.10303Z'
              fill='#4CA6E6'
            />
            <path
              d='M23.0175 30.9344L13.0379 25.1649V20.6899L23.0175 26.4595L32.9968 20.6899V25.1649L23.0175 30.9344Z'
              fill='#4CA6E6'
            />
            <path
              d='M3.23164 13.5502L13.2112 7.78027L17.081 10.0179L7.1018 15.7878V27.3277L3.23164 25.09V13.5502Z'
              fill='#4CA6E6'
            />
            <path
              d='M28.1004 5.00587L18.1208 -0.763672L14.2507 1.47399L24.2299 7.24353V18.7834L28.1004 16.5457V5.00587Z'
              fill='#4CA6E6'
            />
            <path
              d='M8.16226 27.9934L8.16263 16.454L12.0328 14.2163V25.7561L22.012 31.5257L18.1419 33.7637L8.16226 27.9934Z'
              fill='#4CA6E6'
            />
            <path
              d='M32.9968 19.4879V7.94811L29.1266 5.71045V17.2499L19.1474 23.0202L23.0175 25.2582L32.9968 19.4879Z'
              fill='#4CA6E6'
            />
            <path
              d='M50.6941 10.0587H41.9376V15.3609H49.1102V17.4455H41.9376V24.9681H39.426V7.97412H50.6941V10.0587ZM63.7269 19.3941V20.2325H54.9252C54.9252 22.2944 56.8937 23.2914 58.3418 23.2914C59.4053 23.2914 60.5818 22.7249 61.2154 21.8186L62.8219 23.2687C62.0752 24.2884 60.8534 25.1947 58.3418 25.1947C54.7216 25.1947 52.5042 22.7249 52.5042 19.3941C52.5042 16.0633 54.6537 13.5708 58.1156 13.5708C61.5774 13.5708 63.1613 15.4968 63.6364 18.3065C63.7043 18.669 63.7269 19.0316 63.7269 19.3941ZM54.9705 18.3065H61.2833C61.2833 16.4938 59.8352 15.4968 58.1156 15.4968C56.3959 15.4968 54.9705 16.6524 54.9705 18.3065ZM79.4524 13.7747H81.7829L77.5291 24.9681H76.1037L73.3206 17.7174L70.5602 24.9681H69.1347L64.8583 13.7747H67.2114L69.8587 21.592L72.1893 14.7037L72.4834 13.7747H74.1578L74.4745 14.7037L76.8051 21.592L79.4524 13.7747ZM91.2182 20.6177C91.2634 20.7536 91.6481 21.8639 91.1729 22.9968C90.5846 24.3337 89.0234 25.1947 87.0775 25.1947H87.0549C85.4937 25.1947 84.0682 24.5376 83.0047 23.4953L84.5207 21.9772C85.1543 22.7929 86.0593 23.2008 87.0549 23.2008C88.1636 23.2008 89.0913 22.7929 89.3402 22.2038C89.4986 21.7959 89.3628 21.3654 89.3628 21.3201C89.0913 20.6403 88.0957 20.5044 86.9644 20.2551C85.4484 19.9152 83.9324 19.5301 83.3441 17.9439C83.05 17.1282 83.1405 16.1766 83.5478 15.3835C84.4755 13.6388 86.7834 13.5708 87.0549 13.5708C88.6161 13.5708 90.0869 14.1599 91.1277 15.2249L89.6117 16.743C88.9782 15.9273 88.0505 15.5648 87.0549 15.5648C87.0323 15.5648 85.6973 15.5874 85.3127 16.3352C85.1769 16.5618 85.109 16.947 85.2221 17.2642C85.4484 17.8986 86.4666 18.1026 87.5527 18.3518C89.0234 18.6917 90.6299 19.0316 91.2182 20.6177ZM98.7754 13.5482C101.988 13.5482 103.278 15.4968 103.278 17.1509V24.9681H100.948V23.7446C100.133 24.8548 98.6849 25.1721 97.7799 25.1721C95.2231 25.1721 93.5487 23.6766 93.5487 21.6826C93.5487 18.8956 95.6304 17.8986 97.7799 17.8986H100.948V17.1509C100.948 16.4485 100.676 15.4741 98.7754 15.4741C97.712 15.4741 96.7391 16.0406 96.1055 16.9243L94.499 15.4741C95.5625 14.2959 97.0785 13.5482 98.7754 13.5482ZM100.948 21.4787V19.802H98.0967C96.7164 19.802 95.7435 20.5044 95.9019 21.7733C96.0376 22.8382 96.8974 23.2687 98.0967 23.2687C100.246 23.2687 100.948 22.2491 100.948 21.4787ZM110.383 23.1101C111.107 23.4047 111.673 23.2008 112.012 23.0421V24.8548C111.718 25.0361 111.288 25.1947 110.677 25.1947C109.342 25.1947 108.165 24.7642 107.441 23.586C106.763 22.453 106.763 21.8412 106.763 20.0739V15.6781H105.405V13.7747H106.763V10.24H109.093V13.7747H112.012V15.6781H109.093V20.0739C109.093 21.9319 109.274 22.6116 110.383 23.1101ZM122.579 20.6177C122.624 20.7536 123.008 21.8639 122.533 22.9968C121.945 24.3337 120.384 25.1947 118.438 25.1947H118.415C116.854 25.1947 115.429 24.5376 114.365 23.4953L115.881 21.9772C116.515 22.7929 117.42 23.2008 118.415 23.2008C119.524 23.2008 120.452 22.7929 120.701 22.2038C120.859 21.7959 120.723 21.3654 120.723 21.3201C120.452 20.6403 119.456 20.5044 118.325 20.2551C116.809 19.9152 115.293 19.5301 114.705 17.9439C114.41 17.1282 114.501 16.1766 114.908 15.3835C115.836 13.6388 118.144 13.5708 118.415 13.5708C119.977 13.5708 121.447 14.1599 122.488 15.2249L120.972 16.743C120.339 15.9273 119.411 15.5648 118.415 15.5648C118.393 15.5648 117.058 15.5874 116.673 16.3352C116.537 16.5618 116.469 16.947 116.583 17.2642C116.809 17.8986 117.827 18.1026 118.913 18.3518C120.384 18.6917 121.99 19.0316 122.579 20.6177Z'
              fill='#ffffff'
            />
          </svg>
        </div>
      </div>
    ),
    {
      ...size,
    }
  );
}
